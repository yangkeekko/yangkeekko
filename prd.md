# 图片字幕生成器 PRD

## 1. 背景与目标
- 目标：提供一个纯前端的网页工具，为任意图片在底部生成多行字幕。每一行字幕都位于相同样式的背景块中，背景块之间用分割线形成“切割感”，并支持即时预览与一键保存。
- 参考效果：与截图一致，底部出现若干水平背景块，每块居中显示一行文字；块与块之间有清晰分割线；整体贴近图片底部。

## 2. 用户与场景
- 用户：需要快速为图片添加底部字幕的普通用户、自媒体作者、设计师等。
- 典型流程：上传图片 → 配置参数（字幕高度、字体大小、颜色等） → 输入多行文本 → 生成 → 保存图片。

## 3. 页面结构
- 页面标题：`图片字幕生成器`。
- 模块与控件：
  1) 文件选择：本地上传图片（显示已选文件名）。
  2) 参数设置：
     - 字幕高度(px)：单行背景块的高度，默认 `40`。
     - 字体大小(px)：字幕文字大小，默认 `20`。
     - 字体颜色：默认 `#FFFFFF`（白）。
     - 轮廓颜色：默认 `#000000`（黑）。用于文字描边与分割线颜色。
  3) 字幕文本输入区：多行文本框，以换行分隔字幕行。
  4) 操作按钮：
     - 生成字幕图片
     - 保存图片
  5) 预览区：展示生成后的图片效果。

## 4. 功能需求
- 图片上传：
  - 支持 `png`、`jpg`、`jpeg`。
  - 读取后在预览区显示原图或缩放后的合成结果。
- 文本处理：
  - 以换行拆分多个字幕行，自动去除首尾空白；忽略完全空行（不生成对应背景块）。
- 渲染规则（核心“切割感”）：
  - 位置：整体字幕区域贴近图片底部。
  - 背景块：每一行文字对应一个等宽等高的矩形背景块（宽度=图片宽度，高度=“字幕高度”）。
  - 背景块样式：统一颜色与透明度（默认 `rgba(0,0,0,0.6)`），所有行一致。
  - 分割线：在相邻背景块之间绘制一条水平分割线（颜色=“轮廓颜色”，默认 1–2px），形成明显的切割感。
  - 文本：
    - 水平居中、垂直居中于其背景块。
    - 字体大小来自“字体大小(px)”。
    - 字体颜色来自“字体颜色”。
    - 文字描边（stroke）：使用“轮廓颜色”，描边宽度默认 `2px`，增强可读性。
  - 行距：由分割线厚度控制，不额外增加上下间距。
- 生成与保存：
  - 点击“生成字幕图片”：即时在预览区合成并显示结果。
  - 点击“保存图片”：将合成后的画布导出为 `PNG` 文件并触发下载；默认文件名：`<原文件名>_subtitle.png`。
- 状态提示：
  - 未选择图片时禁用“生成字幕图片/保存图片”或给予提示。
  - 生成/保存成功与失败均需有明确反馈。

## 5. 参数与默认值（可配置项）
- `subtitleHeight`（字幕高度）：默认 `40`，范围 `20–120`。
- `fontSize`（字体大小）：默认 `20`，范围 `12–72`。
- `fontColor`（字体颜色）：默认 `#FFFFFF`。
- `strokeColor`（轮廓颜色）：默认 `#000000`。
- `dividerThickness`（分割线厚度）：默认 `1px`，范围 `1–4px`。
- `backgroundColor`（背景块颜色）：默认 `rgba(0,0,0,0.6)`。

## 6. 交互流程
1) 用户选择本地图片文件，立即在内存中读取。
2) 用户设置字幕参数（高度、字体大小、颜色、轮廓）。
3) 用户在多行文本框输入字幕，每一行对应一个背景块。
4) 点击“生成字幕图片”，在预览区生成合成效果：
   - 底部按行绘制统一样式的背景块；
   - 行与行之间绘制分割线；
   - 每块内文字居中显示并带描边。
5) 用户点击“保存图片”，下载合成后的 PNG。

## 7. 渲染实现（建议）
- 技术栈：原生 HTML + CSS + JavaScript + Canvas 2D。
- 主要步骤（伪代码）：
  ```js
  const img = await loadImage(file);
  const lines = textarea.value
    .split('\n')
    .map(s => s.trim())
    .filter(s => s.length > 0);

  const n = lines.length;
  const divider = dividerThickness; // 1–2px
  const blockH = subtitleHeight;    // 40px 默认
  const totalH = n * blockH + (n - 1) * divider;
  const startY = img.height - totalH; // 贴底部

  // 绘制原图
  ctx.drawImage(img, 0, 0);

  // 逐行绘制背景块、分割线和文字
  let y = startY;
  for (let i = 0; i < n; i++) {
    // 背景块
    ctx.fillStyle = backgroundColor; // rgba(0,0,0,0.6)
    ctx.fillRect(0, y, img.width, blockH);

    // 文本（居中 + 描边）
    ctx.font = `${fontSize}px Microsoft YaHei, Arial, sans-serif`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.lineWidth = 2; // 描边宽度
    ctx.strokeStyle = strokeColor;
    ctx.fillStyle = fontColor;
    const cx = img.width / 2;
    const cy = y + blockH / 2;
    ctx.strokeText(lines[i], cx, cy);
    ctx.fillText(lines[i], cx, cy);

    // 分割线（除最后一行外）
    if (i < n - 1) {
      ctx.fillStyle = strokeColor;
      ctx.fillRect(0, y + blockH, img.width, divider);
    }

    y += blockH + divider;
  }
  ```

## 8. 兼容性与约束
- 浏览器：现代主流浏览器（Chrome/Edge/Firefox/Safari）。
- 图像尺寸：建议在不超过 `4000x4000` 的范围内；过大图片可提示或缩放以避免内存压力。
- 字幕长度：默认不自动换行，请用户控制单行长度以适配图片宽度（可在后续扩展中提供“自动换行/缩小字体”选项）。

## 9. 错误与边界情况
- 未选择图片：禁用相关按钮或弹出提示。
- 非支持格式：给出错误提示。
- 文本为空：生成时提示“未检测到字幕行”。
- 参数越界：恢复至默认或限制在允许范围。

## 10. 验收标准
- 生成的图片底部由若干背景块组成，每块高相同、宽等于图片宽；相邻背景块之间存在清晰分割线，整体呈现“切割感”。
- 每个背景块内的文字水平居中、垂直居中、颜色与描边符合设置。
- 预览效果与保存后的图片一致。
- 所有控件默认值与交互符合本 PRD 描述。

## 11. 后续扩展（非必需）
- 可选背景颜色与不透明度调节。
- 文本自动换行或自适应字号。
- 字体选择与粗细（Regular/Bold）。
- 顶部或中部字幕位置模式。
- 批量处理多张图片。

